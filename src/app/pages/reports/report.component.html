<form
  class="container d-flex flex-column gap-4 mt-4"
  (ngSubmit)="onSubmit()"
  [formGroup]="form"
  #formDir="ngForm"
>
  <div class="row d-flex justify-content-center">
    <div class="col-md-6 col-sm-12">
      <label for="types">Tipo de transação</label>
      <select id="types" class="form-select" formControlName="transaction_type">
        <option value="" [defaultSelected]="true">Entrada/Saída</option>
        <option value="revenue">Entrada</option>
        <option value="expense">Saída</option>
      </select>
    </div>

    <div class="col-md-6 col-sm-12">
      <label for="categories">Categoria</label>
      <select id="categories" class="form-select" formControlName="category_id">
        <option value="" [defaultSelected]="true">Todas</option>
        <ng-container *ngFor="let category of categories">
          <ng-container
            *ngIf="category?.type === formDir.value.transaction_type"
          >
            <option #valid [ngValue]="category.id">
              {{ category.name }}
            </option>
          </ng-container>
        </ng-container>
      </select>
    </div>
  </div>

  <div class="row d-flex justify-content-center">
    <div class="col-md-6 col-sm-12">
      <label for="date">Data Inicial</label>
      <input
        type="date"
        id="date"
        class="form-control"
        max="{{ form.value.final_date }}"
        formControlName="initial_date"
      />
    </div>

    <div class="col-md-6 col-sm-12">
      <label for="final_date">Data Final</label>
      <input
        type="date"
        min="{{ form.value.initial_date }}"
        id="date"
        class="form-control"
        formControlName="final_date"
      />
    </div>
  </div>

  <div>
    <div class="modal-footer d-flex pt-2 justify-content-center">
      <button type="submit" class="btn btn-primary" data-bs-dismiss="modal">
        Pesquisar
      </button>
    </div>
  </div>
</form>

<div
  class="w-75 mx-auto d-flex flex-wrap justify-content-center gap-5 space mt-5 mb-5"
>
  <div
    [ngClass]="(expenses | keyvalue).length > 0 ? '' : 'visually-hidden'"
    class="accordion border rounded border-danger p-2 mb-2 border-opacity-75"
  >
    <div class="bg-danger border rounded">
      <h3 class="text-center">Saídas</h3>
    </div>
    <div *ngFor="let expense of expenses | keyvalue" class="accordion-item">
      <h2 class="accordion-header">
        <button
          class="accordion-button collapsed"
          type="button"
          data-bs-toggle="collapse"
          (click)="toggleList(expense.key)"
        >
          {{ expense.key }}
        </button>
      </h2>
      <div [id]="expense.key" class="accordion-collapse collapse">
        <div class="accordion-body">
          <table class="table table-striped">
            <thead>
              <tr>
                <th scope="col">Data</th>
                <th scope="col">Valor</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let transaction of expense.value">
                <td>{{ transaction.date }}</td>
                <td>{{ transaction.value | formatCurrencyBRL }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div
    [ngClass]="(revenues | keyvalue).length > 0 ? '' : 'visually-hidden'"
    class="accordion border rounded border-success p-2 mb-2 border-opacity-75"
  >
    <div class="bg-success border rounded">
      <h3 class="text-center">Entradas</h3>
    </div>
    <div *ngFor="let revenue of revenues | keyvalue" class="accordion-item">
      <h2 class="accordion-header">
        <button
          class="accordion-button collapsed"
          type="button"
          data-bs-toggle="collapse"
          (click)="toggleList(revenue.key)"
        >
          {{ revenue.key }}
        </button>
      </h2>
      <div [id]="revenue.key" class="accordion-collapse collapse">
        <div class="accordion-body">
          <table class="table table-striped">
            <thead>
              <tr>
                <th scope="col">Data</th>
                <th scope="col">Valor</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let transaction of revenue.value">
                <td>{{ transaction.date }}</td>
                <td>{{ transaction.value | formatCurrencyBRL }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
