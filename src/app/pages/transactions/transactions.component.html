<div class="d-flex gap-4 mx-auto mt-4 flex-column justify-content-center w-75">
  <form
    class="container d-flex flex-column gap-4"
    (ngSubmit)="onSubmit()"
    [formGroup]="transactionForm"
    #formDir="ngForm"
  >
    <div class="row d-flex justify-content-center">
      <div class="col-md-4 col-sm-12">
        <label for="types">Tipo de transação</label>
        <select
          id="types"
          class="form-select"
          [ngClass]="type.invalid && formDir.submitted ? 'is-invalid' : ''"
          formControlName="type"
          required
        >
          <option [defaultSelected]="true" disabled>Selecione o tipo</option>
          <option value="revenue" id="4">Entrada</option>
          <option value="expense">Saída</option>
        </select>
        <div class="invalid-feedback" *ngIf="type.errors?.['required']">
          <ng-container> Selecione o tipo de transação </ng-container>
        </div>
      </div>

      <div class="col-md-4 col-sm-12">
        <label for="categories">Categoria</label>
        <select
          id="categories"
          class="form-select"
          [ngClass]="
            category_id.invalid && formDir.submitted ? 'is-invalid' : ''
          "
          formControlName="category_id"
          required
        >
          <option disabled [defaultSelected]="true">
            Selecione a categoria
          </option>
          <ng-container *ngFor="let category of categories">
            <option
              [ngValue]="category.id"
              *ngIf="category.type === formDir.value.type"
            >
              {{ category.name }}
            </option>
          </ng-container>
        </select>
        <div class="invalid-feedback" *ngIf="category_id.errors?.['required']">
          <ng-container> Selecione a categoria </ng-container>
        </div>
      </div>
    </div>

    <div class="row d-flex justify-content-center">
      <div class="col-md-4 col-sm-12">
        <label for="value">Valor da transação</label>
        <div class="input-group mb-3">
          <span class="input-group-text">R$</span>
          <input
            id="value"
            formControlName="value"
            type="text"
            [ngClass]="value.invalid && formDir.submitted ? 'is-invalid' : ''"
            class="form-control"
            mask="separator"
            thousandSeparator="."
            required
          />

          <div class="invalid-feedback">
            <ng-container *ngIf="value.errors?.['required']">
              Informe o valor
            </ng-container>
            <ng-container *ngIf="value.errors?.['min']">
              Informe um valor maior que 0
            </ng-container>
          </div>
        </div>
      </div>

      <div class="col-md-4 col-sm-12">
        <label for="date">Data da transação</label>
        <input
          type="date"
          id="date"
          class="form-control"
          [ngClass]="date.invalid && formDir.submitted ? 'is-invalid' : ''"
          formControlName="date"
          required
        />
        {{ date.pristine }}
        <div class="invalid-feedback">
          <ng-container *ngIf="!date.errors?.['required']">
            Informe a data
          </ng-container>
        </div>
      </div>

      <div class="row d-flex justify-content-center">
        <div class="col-md-7 col-sm-12">
          <label for="date">Descrição</label>
          <input
            formControlName="description"
            class="form-control"
            type="text"
          />
        </div>
      </div>
    </div>

    <div class="d-flex justify-content-center">
      <button class="btn btn-primary">Cadastrar</button>
    </div>
  </form>

  <div class="table-responsive">
    <table class="table table-hover table-secondary">
      <thead>
        <tr>
          <th>Data</th>
          <th>Categoria</th>
          <th>Tipo</th>
          <th>Descrição</th>
          <th>Valor R$</th>
          <th>opções</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let transaction of transactions"
          [ngClass]="
            transaction.type == 'Saída' ? 'table-danger' : 'table-success'
          "
        >
          <td class="align-top">
            {{ transaction.date | date : "dd/MM/yyyy" }}
          </td>
          <td class="align-top">
            {{ transaction.category?.name }}
          </td>
          <td class="align-top">
            {{ transaction.type }}
          </td>
          <td class="align-top">
            <div class="description">
              {{ transaction.description ? transaction.description : "- -" }}
            </div>
          </td>
          <td class="align-top">
            {{ transaction.value | currency : "BRL" : "symbol" : "1.2-2" }}
          </td>
          <td class="align-top d-flex gap-2">
            <tr class="d-flex gap-2">
              <button
                type="button"
                class="btn btn-sm btn-outline-primary"
                data-bs-toggle="modal"
                data-bs-target="#exampleModal"
                (click)="openModal(transaction)"
              >
                editar
              </button>
              |
              <button class="btn btn-sm btn-outline-danger">excluir</button>
            </tr>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal -->
  <div
    class="modal fade"
    id="exampleModal"
    tabindex="-1"
    aria-labelledby="exampleModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">{{ transactionSelected.id }}</div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Close
          </button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div>
</div>
